<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Eylül Performans Dashboard</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e1 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      color: #1f2937;
    }

    .dashboard-container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .header {
      margin-bottom: 24px;
    }

    .header h1 {
      margin: 0 0 8px;
      font-size: 2rem;
      color: #111827;
      text-align: center;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.08);
    }

    .header p {
      margin: 0;
      opacity: 0.9;
      text-align: center;
      color: #374151;
    }

    .summary-card {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      border: 1px solid #e2e8f0;
      border-radius: 16px;
      padding: 20px;
      margin: 20px 0 24px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.06);
    }

    .summary-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
    }

    .summary-item {
      background: white;
      border-radius: 12px;
      padding: 16px;
      border: 1px solid #e5e7eb;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      text-align: center;
    }

    .summary-item .label {
      font-size: 0.9rem;
      color: #6b7280;
      margin-bottom: 6px;
    }

    .summary-item .value {
      font-size: 1.25rem;
      font-weight: 700;
      color: #111827;
    }

    .speedometer-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 24px;
      margin-top: 10px;
    }

    .speedometer-card {
      background: white;
      border-radius: 16px;
      padding: 18px;
      border: 1px solid #e5e7eb;
      box-shadow: 0 8px 24px rgba(0,0,0,0.08);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .speedometer-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 28px rgba(0,0,0,0.12);
    }
    .speedometer-card.manager {
      background: #f3f4f6;
      border-color: #e5e7eb;
    }
    /* Leaders (Bölge Müdürü / Direktör) için hafif vurgu */
    .speedometer-card.leader {
      background: #eef2ff; /* subtle indigo tint */
      border-color: #dbeafe;
    }
    .speedometer-card.no-title {
      background: #e5e7eb;
      border-color: #d1d5db;
      color: #111827;
    }
    .speedometer-card.inactive {
      background: #f3f4f6;
      border-color: #e5e7eb;
      filter: grayscale(0.2);
    }

    .achievement-badge {
      display: inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
      color: white;
      margin-bottom: 8px;
    }
    .badge-excellent { background: #108981; }
    .badge-good { background: #4f46e5; }
    .badge-needs-improvement { background: #dc2626; }

    .card-header h3 {
      margin: 0 0 2px;
      font-size: 1.1rem;
    }
    .person-title {
      color: #6b7280;
      font-size: 0.85rem;
    }

    .speedometer-svg { width: 100%; height: auto; margin: 6px 0 10px; }

    .stats-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-top: 6px;
    }
    .stat-item { background: #f8fafc; border-radius: 10px; padding: 10px; text-align: center; }
    .stat-label { font-size: 0.8rem; color: #6b7280; margin-bottom: 4px; }
    .stat-value { font-size: 1rem; font-weight: 700; color: #111827; }

    @media (max-width: 640px) {
      .stats-container { grid-template-columns: 1fr; }
    }

    /* Hamburger Menu */
    .hamburger-menu {
      position: fixed;
      top: 16px;
      left: 16px;
      z-index: 1001;
    }
    .hamburger-btn {
      background: #ffffff;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      width: 48px;
      height: 48px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      transition: transform 0.2s ease;
    }
    .hamburger-btn:hover { transform: scale(1.04); }
    .hamburger-line {
      width: 22px; height: 2px; background: #374151; border-radius: 2px;
    }

    .menu-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.45); display: none; z-index: 1000;
      backdrop-filter: blur(3px);
    }
    .menu-content {
      position: fixed; top: 0; left: -320px; width: 300px; height: 100vh; background: #ffffff; z-index: 1002;
      box-shadow: 8px 0 24px rgba(0,0,0,0.12); padding: 16px; transition: left 0.25s ease;
      display: flex; flex-direction: column;
    }
    .menu-content.active { left: 0; }
    .menu-header { font-weight: 700; color: #111827; margin-bottom: 12px; font-size: 1.1rem; }
    .menu-section { display: grid; gap: 8px; }
    .menu-btn { padding: 10px 12px; border-radius: 10px; border: 1px solid #e5e7eb; background: #f9fafb; cursor: pointer; text-align: left; }
    .menu-btn:hover { background: #eef2ff; border-color: #c7d2fe; }

    /* Month Dashboard (Ocak–Ağustos) */
    .month-container { max-width: 1400px; margin: 0 auto; display: none; }
    .month-header { text-align: center; margin: 12px 0 16px; }
    .month-header h2 { margin: 0; color: #111827; }
    .name-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; }
    .name-card { background: white; border: 1px solid #e5e7eb; border-radius: 12px; padding: 14px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.06); }
    .name-card.manager { background: #f3f4f6; color: #6b7280; border-color: #e5e7eb; }
  </style>
</head>
<body>
  <!-- Hamburger Menu -->
  <div class="hamburger-menu">
    <button class="hamburger-btn" onclick="toggleMenu()">
      <div class="hamburger-line"></div>
      <div class="hamburger-line"></div>
      <div class="hamburger-line"></div>
    </button>
  </div>

  <!-- Year Dashboard -->
  <div class="month-container" id="yearDashboardContainer" style="display:none;">
    <div class="month-header">
      <h2>Yıllık Dashboard</h2>
      <p style="color:#6b7280;margin:6px 0 0;">Tüm ekibin yıllık hedef ve gerçekleşen toplamları</p>
    </div>
    <div class="summary-card">
      <div class="summary-stats" id="yearSummaryStats"></div>
    </div>
    <div class="speedometer-grid" id="yearSpeedometerGrid"></div>
    <div class="summary-card" style="margin-top:16px;">
      <div class="summary-stats" style="display:block;">
        <div class="summary-item" style="grid-column: 1/-1;">
          <div class="label" style="margin-bottom:10px;">Kişi Bazlı Yıllık Toplamlar (Denetim)</div>
          <div id="yearTotalsTable" style="max-height:320px; overflow:auto; font-size:14px; text-align:left;"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="menu-overlay" id="menuOverlay" onclick="closeMenu()"></div>
  <div class="menu-content" id="menuContent">
    <div class="menu-header">Dashboard Menü</div>
    <div class="menu-section">
      <button class="menu-btn" onclick="showSeptember()">Eylül Dashboard</button>
      <button class="menu-btn" onclick="showYear()">Yıllık Dashboard</button>
      <button class="menu-btn" onclick="showMonth('ocak')">Ocak Dashboard</button>
      <button class="menu-btn" onclick="showMonth('subat')">Şubat Dashboard</button>
      <button class="menu-btn" onclick="showMonth('mart')">Mart Dashboard</button>
      <button class="menu-btn" onclick="showMonth('nisan')">Nisan Dashboard</button>
      <button class="menu-btn" onclick="showMonth('mayis')">Mayıs Dashboard</button>
      <button class="menu-btn" onclick="showMonth('haziran')">Haziran Dashboard</button>
      <button class="menu-btn" onclick="showMonth('temmuz')">Temmuz Dashboard</button>
      <button class="menu-btn" onclick="showMonth('agustos')">Ağustos Dashboard</button>
    </div>
  </div>
  <div class="dashboard-container" id="septemberDashboardContainer">
    <div class="header">
      <h1>Eylül Performans Dashboard</h1>
      <p>Eylül 2025 Satış Hedefleri ve Gerçekleşen Satışlar</p>
    </div>

    <div class="summary-card">
      <div class="summary-stats" id="septemberSummaryStats"></div>
    </div>

    <div class="speedometer-grid" id="septemberSpeedometerGrid"></div>
  </div>

  <!-- Month Dashboard (summary + speedometer cards) -->
  <div class="month-container" id="monthDashboardContainer">
    <div class="month-header">
      <h2 id="monthTitle">Ay</h2>
      <p style="color:#6b7280;margin:6px 0 0;">Aylık hedef ve gerçekleşen performans</p>
    </div>
    <div class="summary-card">
      <div class="summary-stats" id="monthSummaryStats"></div>
    </div>
    <div class="speedometer-grid" id="monthSpeedometerGrid"></div>
  </div>

  <script>
    // Eylül hedefleri (görsele göre)
    const septemberTargets = {
      "Betül Köse": 450000,
      "Damla Kalemtaş": 850000,
      "Egehan Öncü": 850000,
      "Fahri Aktoz": 1250000,
      "Güven Gürkan Salıkoç": 650000,
      "Hüseyin Çakmak": 1250000,
      "Özge Kaçaroğlu": 450000,
      "Sebahat Çay": 1300000,
      "Tuğçe Bugakaptan": 850000,
      "Umut Karaerarslan": 850000,
      "Gizem Güler Ilısu": 450000
    };

    // Eylül satış satırları (görsele göre tek toplamlar)
    const eylulSalesLines = {
      "Betül Köse": { netTahsilat: 374458, netEkstre: 0, posRapor: 0 },
      "Damla Kalemtaş": { netTahsilat: 217000, netEkstre: 0, posRapor: 0 },
      "Egehan Öncü": { netTahsilat: 755192, netEkstre: 0, posRapor: 0 },
      "Fahri Aktoz": { netTahsilat: 110000, netEkstre: 0, posRapor: 0 },
      "Güven Gürkan Salıkoç": { netTahsilat: 315866, netEkstre: 0, posRapor: 0 },
      "Hüseyin Çakmak": { netTahsilat: 797562, netEkstre: 0, posRapor: 0 },
      "Özge Kaçaroğlu": { netTahsilat: 55000, netEkstre: 0, posRapor: 0 },
      "Sebahat Çay": { netTahsilat: 199944, netEkstre: 0, posRapor: 0 },
      "Tuğçe Bugakaptan": { netTahsilat: 445528, netEkstre: 0, posRapor: 0 },
      "Umut Karaerarslan": { netTahsilat: 1079994, netEkstre: 0, posRapor: 0 },
      "Gizem Güler Ilısu": { netTahsilat: 0, netEkstre: 0, posRapor: 0 }
    };

    // Kartlara temel veri modeli
    const people = Object.keys(septemberTargets).map(name => {
      const target = septemberTargets[name] || 0;
      const sums = eylulSalesLines[name] || { netTahsilat: 0, netEkstre: 0, posRapor: 0 };
      const actual = (sums.netTahsilat || 0) + (sums.netEkstre || 0) + (sums.posRapor || 0);
      return {
        name,
        title: '',
        target,
        actual
      };
    });

    // Görünürlük filtresi (istenmeyen isimleri kaldır)
    function getVisibleData(list) {
      return list.filter(person => person.name !== "Umut Çakıroğlu" && person.name !== "Ali Altınay");
    }

    function createSpeedometer(data) {
      const percentage = data.target > 0 ? (data.actual / data.target) * 100 : 0;
      const showBadge = data.target > 0; // Hedefi olmayanlarda rozet göstermeyelim (örn. Ali Altınay, Umut Çakıroğlu)
      const isLeader = !!data.manager || data.title === 'Direktör' || data.role === 'Direktör';
      let badgeClass = 'badge-excellent';
      let badgeText = 'Mükemmel';
      if (percentage < 50) { badgeClass = 'badge-needs-improvement'; badgeText = 'Hedef Altında'; }
      else if (percentage < 80) { badgeClass = 'badge-good'; badgeText = 'İyi'; }

      const angle = 180 - Math.min(percentage / 100, 1) * 180;
      const needleRad = (angle * Math.PI) / 180;
      const needleLength = 80;
      const needleX = needleLength * Math.cos(needleRad);
      const needleY = -needleLength * Math.sin(needleRad);
      const gradId = 'grad-' + data.name.replace(/\s+/g,'');

      const svg = `
        <svg class="speedometer-svg" viewBox="0 0 280 180">
          <defs>
            <linearGradient id="${gradId}" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" style="stop-color:#dc2626;stop-opacity:1" />
              <stop offset="50%" style="stop-color:#f59e0b;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#10b981;stop-opacity:1" />
            </linearGradient>
          </defs>
          <path d="M 40 140 A 100 100 0 0 1 240 140" fill="none" stroke="#e5e7eb" stroke-width="20" stroke-linecap="round"/>
          <path d="M 40 140 A 100 100 0 0 1 240 140" fill="none" stroke="url(#${gradId})" stroke-width="20" stroke-linecap="round" stroke-dasharray="${(Math.max(0, Math.min(percentage,100)) / 100) * 314} 314"/>
          <g transform="translate(140, 140)">
            <line x1="0" y1="0" x2="${needleX}" y2="${needleY}" stroke="#111827" stroke-width="3" stroke-linecap="round"/>
            <circle cx="0" cy="0" r="8" fill="#111827"/>
            <circle cx="0" cy="0" r="4" fill="white"/>
          </g>
          <text x="140" y="120" text-anchor="middle" font-size="24" font-weight="bold" fill="#111827">${percentage.toFixed(0)}%</text>
          <g transform="translate(140, 140)">
            <text x="-75" y="55" text-anchor="middle" font-size="12" fill="#6b7280">0%</text>
            <text x="75" y="55" text-anchor="middle" font-size="12" fill="#6b7280">100%</text>
          </g>
        </svg>`;

      const displayTitle = data.title || (data.inactive || data.role === 'İşten Ayrıldı' ? 'İşten Ayrıldı' : '');
      const noTitleClass = displayTitle ? '' : ' no-title';
      const cardExtraClass = isLeader ? ' leader' : '';
      const successText = showBadge ? `${percentage.toFixed(0)}%` : '—';
      return `
        <div class="speedometer-card${data.manager ? ' manager' : ''}${data.inactive ? ' inactive' : ''}${cardExtraClass}${noTitleClass}">
          ${showBadge ? `<div class=\"achievement-badge ${badgeClass}\">${badgeText}</div>` : ''}
          <div class="card-header">
            <h3>${data.name}</h3>
            ${displayTitle ? `<div class="person-title">${displayTitle}</div>` : ''}
          </div>
          ${isLeader ? '' : `<div class=\"speedometer-container\">${svg}</div>`}
          <div class="stats-container">
            <div class="stat-item"><div class="stat-label">Hedef</div><div class="stat-value">₺${data.target.toLocaleString('tr-TR')}</div></div>
            <div class="stat-item"><div class="stat-label">Gerçekleşen</div><div class="stat-value">₺${data.actual.toLocaleString('tr-TR')}</div></div>
            <div class="stat-item"><div class="stat-label">Başarı</div><div class="stat-value">${successText}</div></div>
          </div>
        </div>`;
    }

    function renderSeptemberSummary(list) {
      const totalTarget = list.reduce((s,p)=> s + (p.target || 0), 0);
      const totalActual = list.reduce((s,p)=> s + (p.actual || 0), 0);
      const rate = totalTarget > 0 ? (totalActual / totalTarget) * 100 : 0;
      const el = document.getElementById('septemberSummaryStats');
      el.innerHTML = `
        <div class="summary-item">
          <div class="label">Toplam Hedef</div>
          <div class="value">₺${totalTarget.toLocaleString('tr-TR')}</div>
        </div>
        <div class="summary-item">
          <div class="label">Toplam Gerçekleşen</div>
          <div class="value">₺${totalActual.toLocaleString('tr-TR')}</div>
        </div>
        <div class="summary-item">
          <div class="label">Başarı Oranı</div>
          <div class="value">%${rate.toFixed(1)}</div>
        </div>`;
    }

    function renderSeptemberDashboard() {
      const grid = document.getElementById('septemberSpeedometerGrid');
      const visible = getVisibleData(people);
      const sorted = [...visible].sort((a,b) => {
        const ar = a.target > 0 ? (a.actual/a.target) : 0;
        const br = b.target > 0 ? (b.actual/b.target) : 0;
        return br - ar;
      });
      grid.innerHTML = sorted.map(p => createSpeedometer(p)).join('');
      renderSeptemberSummary(sorted);
    }

    // Başlat
    renderSeptemberDashboard();

    // Hamburger menu + switching
    function toggleMenu(){
      const overlay = document.getElementById('menuOverlay');
      const content = document.getElementById('menuContent');
      const isOpen = overlay.style.display === 'block';
      overlay.style.display = isOpen ? 'none' : 'block';
      content.classList.toggle('active');
    }
    function closeMenu(){
      const overlay = document.getElementById('menuOverlay');
      const content = document.getElementById('menuContent');
      overlay.style.display = 'none';
      content.classList.remove('active');
    }

    const monthLabels = {
      ocak: 'Ocak', subat: 'Şubat', mart: 'Mart', nisan: 'Nisan', mayis: 'Mayıs', haziran: 'Haziran', temmuz: 'Temmuz', agustos: 'Ağustos'
    };

    // Kartını gizlemek istediğimiz isimler (toplamlara dahil)
    const hiddenNames = ['Umut Çakıroğlu', 'Ali Altınay'];

    // All names for month views (include directors even if they have no individual targets)
    const personNames = Object.keys(septemberTargets).concat(['Ali Altınay', 'Umut Çakıroğlu']);

    // Month-specific minimal datasets (name-only cards now, but keep values for future)
    const monthPeople = {
      ocak: [
        { name: 'Ali Altınay', target: 0, actual: 150000 + 28000, role: 'Bölge Müdürü', manager: true },
        { name: 'Ali Çağatay Doğan', target: 0, actual: 404925, role: 'İşten Ayrıldı', inactive: true },
        { name: 'Barış Dülger', target: 0, actual: 351820 + 69180, role: 'İşten Ayrıldı', inactive: true },
        { name: 'Batuhan Arısüt', target: 0, actual: 100650 + 57800, role: 'İşten Ayrıldı', inactive: true },
        { name: 'Duygu Yarbaş Sanbay', target: 0, actual: 165700, role: 'İşten Ayrıldı', inactive: true }
        ,{ name: 'Fahri Aktoz', target: 800000, actual: 408000, title: 'Müdür' }
        ,{ name: 'Güven Salıkoç', target: 600000, actual: 363640, title: 'Kıdemli Uzman' }
        ,{ name: 'Hüseyin Çakmak', target: 850000, actual: 810256, title: 'Müdür' }
        ,{ name: 'Sebahat Çay', target: 850000, actual: 396000, title: 'Müdür' }
        ,{ name: 'Tuğçe Bugakaptan', target: 550000, actual: 212988, title: 'Kıdemli Uzman' }
        ,{ name: 'Umut Karaerarslan', target: 600000, actual: 483744, title: 'Kıdemli Uzman' }
        ,{ name: 'Muhammed Sivaslıgil', target: 0, actual: 147925, role: 'İşten Ayrıldı', inactive: true }
      ],
      subat: [
        { name: 'Ali Altınay', target: 0, actual: 259458, role: 'Bölge Müdürü', manager: true },
        { name: 'Batuhan Arısüt', target: 400000, actual: 0, title: '' },
        { name: 'Betül Köse', target: 0, actual: 0, title: 'Kıdemli Uzman' },
        { name: 'Damla Kalemtaş', target: 0, actual: 0, title: 'Müdür Yardımcısı' },
        { name: 'Doğukan Kalyoncu', target: 0, actual: 0, title: 'Müdür' },
        { name: 'Egehan Öncü', target: 0, actual: 0, title: 'Müdür Yardımcısı' },
        { name: 'Fahri Aktoz', target: 1100000, actual: 1090000, title: 'Müdür' },
        { name: 'Güven Salıkoç', target: 950000, actual: 423140, title: 'Kıdemli Uzman' },
        { name: 'Hüseyin Çakmak', target: 1000000, actual: 139500, title: 'Müdür' },
        { name: 'İlter Demirci', target: 910000, actual: 48278, title: '' },
        { name: 'Muhammed Sivaslıgil', target: 870000, actual: 330000, title: '' },
        { name: 'Özge Kaçaroğlu', target: 0, actual: 0, title: 'Kıdemli Uzman' },
        { name: 'Sebahat Çay', target: 850000, actual: 816600, title: 'Müdür' },
        { name: 'Tuğçe Bugakaptan', target: 900000, actual: 405654, title: 'Kıdemli Uzman' },
        { name: 'Umut Çakıroğlu', target: 0, actual: 0, title: 'Direktör' },
        { name: 'Umut Karaerarslan', target: 820000, actual: 405291, title: 'Kıdemli Uzman' }
      ],
      mart: [
        { name: 'Ali Altınay', target: 0, actual: 194904, role: 'Bölge Müdürü', manager: true },
        { name: 'Batuhan Arısüt', target: 0, actual: 0, title: '' },
        { name: 'Betül Köse', target: 0, actual: 0, title: 'Kıdemli Uzman' },
        { name: 'Damla Kalemtaş', target: 450000, actual: 0, title: 'Müdür Yardımcısı' },
        { name: 'Doğukan Kalyoncu', target: 0, actual: 0, title: 'Müdür' },
        { name: 'Egehan Öncü', target: 500000, actual: 0, title: 'Müdür Yardımcısı' },
        { name: 'Fahri Aktoz', target: 1050000, actual: 2275000, title: 'Müdür' },
        { name: 'Güven Salıkoç', target: 950000, actual: 283806, title: 'Kıdemli Uzman' },
        { name: 'Hüseyin Çakmak', target: 1000000, actual: 425000, title: 'Müdür' },
        { name: 'İlter Demirci', target: 900000, actual: 270595, title: '' },
        { name: 'Muhammed Sivaslıgil', target: 800000, actual: 148800, title: '' },
        { name: 'Özge Kaçaroğlu', target: 0, actual: 0, title: 'Kıdemli Uzman' },
        { name: 'Sebahat Çay', target: 800000, actual: 822079, title: 'Müdür' },
        { name: 'Tuğçe Bugakaptan', target: 1200000, actual: 344296, title: 'Kıdemli Uzman' },
        { name: 'Umut Çakıroğlu', target: 0, actual: 0, title: 'Direktör' },
        { name: 'Umut Karaerarslan', target: 750000, actual: 609648, title: 'Kıdemli Uzman' }
      ],
      nisan: [
        { name: 'Ali Altınay', target: 0, actual: 0, role: 'Bölge Müdürü', manager: true },
        { name: 'Batuhan Arısüt', target: 300000, actual: 74320, title: '' },
        { name: 'Betül Köse', target: 370000, actual: 0, title: 'Kıdemli Uzman' },
        { name: 'Damla Kalemtaş', target: 500000, actual: 590565, title: 'Müdür Yardımcısı' },
        { name: 'Doğukan Kalyoncu', target: 0, actual: 0, title: 'Müdür' },
        { name: 'Egehan Öncü', target: 500000, actual: 79850, title: 'Müdür Yardımcısı' },
        { name: 'Fahri Aktoz', target: 1100000, actual: 840000, title: 'Müdür' },
        { name: 'Güven Salıkoç', target: 1105000, actual: 1071554, title: 'Kıdemli Uzman' },
        { name: 'Hüseyin Çakmak', target: 1075000, actual: 494175, title: 'Müdür' },
        { name: 'İlter Demirci', target: 875000, actual: 76075, title: '' },
        { name: 'Muhammed Sivaslıgil', target: 850000, actual: 313220, title: '' },
        { name: 'Özge Kaçaroğlu', target: 0, actual: 0, title: 'Kıdemli Uzman' },
        { name: 'Sebahat Çay', target: 850000, actual: 808919, title: 'Müdür' },
        { name: 'Tuğçe Bugakaptan', target: 1075000, actual: 430535, title: 'Kıdemli Uzman' },
        { name: 'Umut Çakıroğlu', target: 0, actual: 0, title: 'Direktör' },
        { name: 'Umut Karaerarslan', target: 750000, actual: 489146, title: 'Kıdemli Uzman' }
      ],
      mayis: [
        { name: 'Ali Altınay', target: 0, actual: 265000, role: 'Bölge Müdürü', manager: true },
        { name: 'Batuhan Arısüt', target: 600000, actual: 0, title: '' },
        { name: 'Betül Köse', target: 500000, actual: 0, title: 'Kıdemli Uzman' },
        { name: 'Damla Kalemtaş', target: 750000, actual: 690364, title: 'Müdür Yardımcısı' },
        { name: 'Doğukan Kalyoncu', target: 0, actual: 0, title: 'Müdür' },
        { name: 'Egehan Öncü', target: 700000, actual: 0, title: 'Müdür Yardımcısı' },
        { name: 'Fahri Aktoz', target: 1300000, actual: 420000, title: 'Müdür' },
        { name: 'Güven Salıkoç', target: 950000, actual: 142942, title: 'Kıdemli Uzman' },
        { name: 'Hüseyin Çakmak', target: 1000000, actual: 406864, title: 'Müdür' },
        { name: 'İlter Demirci', target: 0, actual: 0, title: '' },
        { name: 'Muhammed Sivaslıgil', target: 750000, actual: 0, title: '' },
        { name: 'Özge Kaçaroğlu', target: 0, actual: 0, title: 'Kıdemli Uzman' },
        { name: 'Sebahat Çay', target: 1100000, actual: 260300, title: 'Müdür' },
        { name: 'Tuğçe Bugakaptan', target: 950000, actual: 647750, title: 'Kıdemli Uzman' },
        { name: 'Umut Çakıroğlu', target: 0, actual: 85160, title: 'Direktör' },
        { name: 'Umut Karaerarslan', target: 900000, actual: 399940, title: 'Kıdemli Uzman' }
      ],
      haziran: [
        { name: 'Ali Altınay', target: 0, actual: 0, role: 'Bölge Müdürü', manager: true },
        { name: 'Batuhan Arısüt', target: 450000, actual: 81450, title: '' },
        { name: 'Betül Köse', target: 600000, actual: 0, title: 'Kıdemli Uzman' },
        { name: 'Damla Kalemtaş', target: 550000, actual: 253000, title: 'Müdür Yardımcısı' },
        { name: 'Doğukan Kalyoncu', target: 0, actual: 0, title: 'Müdür' },
        { name: 'Egehan Öncü', target: 450000, actual: 198964, title: 'Müdür Yardımcısı' },
        { name: 'Fahri Aktoz', target: 1000000, actual: 1155020, title: 'Müdür' },
        { name: 'Güven Salıkoç', target: 550000, actual: 318420, title: 'Kıdemli Uzman' },
        { name: 'Hüseyin Çakmak', target: 750000, actual: 1105000, title: 'Müdür' },
        { name: 'İlter Demirci', target: 0, actual: 0, title: '' },
        { name: 'Muhammed Sivaslıgil', target: 0, actual: 0, title: '' },
        { name: 'Özge Kaçaroğlu', target: 0, actual: 0, title: 'Kıdemli Uzman' },
        { name: 'Sebahat Çay', target: 750000, actual: 726109, title: 'Müdür' },
        { name: 'Tuğçe Bugakaptan', target: 550000, actual: 569835, title: 'Kıdemli Uzman' },
        { name: 'Umut Çakıroğlu', target: 0, actual: 151200, title: 'Direktör' },
        { name: 'Umut Karaerarslan', target: 600000, actual: 538146, title: 'Kıdemli Uzman' }
      ],
      temmuz: [
        { name: 'Ali Altınay', target: 0, actual: 0, role: 'Bölge Müdürü', manager: true },
        { name: 'Batuhan Arısüt', target: 0, actual: 0, title: '' },
        { name: 'Betül Köse', target: 280000, actual: 0, title: 'Kıdemli Uzman' },
        { name: 'Damla Kalemtaş', target: 840000, actual: 462040, title: 'Müdür Yardımcısı' },
        { name: 'Doğukan Kalyoncu', target: 754000, actual: 66000, title: 'Müdür' },
        { name: 'Egehan Öncü', target: 672000, actual: 376000, title: 'Müdür Yardımcısı' },
        { name: 'Fahri Aktoz', target: 1120000, actual: 470000, title: 'Müdür' },
        { name: 'Güven Salıkoç', target: 900000, actual: 728900, title: 'Kıdemli Uzman' },
        { name: 'Hüseyin Çakmak', target: 1232000, actual: 1317140, title: 'Müdür' },
        { name: 'İlter Demirci', target: 0, actual: 0, title: '' },
        { name: 'Muhammed Sivaslıgil', target: 0, actual: 0, title: '' },
        { name: 'Özge Kaçaroğlu', target: 280000, actual: 0, title: 'Kıdemli Uzman' },
        { name: 'Sebahat Çay', target: 952000, actual: 558273, title: 'Müdür' },
        { name: 'Tuğçe Bugakaptan', target: 850000, actual: 484867, title: 'Kıdemli Uzman' },
        { name: 'Umut Çakıroğlu', target: 0, actual: 330000, title: 'Direktör' },
        { name: 'Umut Karaerarslan', target: 840000, actual: 576302, title: 'Kıdemli Uzman' },
        { name: 'Gizem Ilısu', target: 280000, actual: 0, title: '' }
      ],
      agustos: [
        { name: 'Ali Altınay', target: 0, actual: 0, role: 'Bölge Müdürü', manager: true },
        { name: 'Batuhan Arısüt', target: 0, actual: 0, title: '' },
        { name: 'Betül Köse', target: 250000, actual: 0, title: 'Kıdemli Uzman' },
        { name: 'Damla Kalemtaş', target: 950000, actual: 776500, title: 'Müdür Yardımcısı' },
        { name: 'Doğukan Kalyoncu', target: 750000, actual: 0, title: 'Müdür' },
        { name: 'Egehan Öncü', target: 850000, actual: 315200, title: 'Müdür Yardımcısı' },
        { name: 'Fahri Aktoz', target: 1250000, actual: 1360000, title: 'Müdür' },
        { name: 'Güven Salıkoç', target: 750000, actual: 763100, title: 'Kıdemli Uzman' },
        { name: 'Hüseyin Çakmak', target: 1250000, actual: 1296610, title: 'Müdür' },
        { name: 'İlter Demirci', target: 0, actual: 0, title: '' },
        { name: 'Muhammed Sivaslıgil', target: 0, actual: 0, title: '' },
        { name: 'Özge Kaçaroğlu', target: 250000, actual: 0, title: 'Kıdemli Uzman' },
        { name: 'Sebahat Çay', target: 950000, actual: 0, title: 'Müdür' },
        { name: 'Tuğçe Bugakaptan', target: 750000, actual: 48499, title: 'Kıdemli Uzman' },
        { name: 'Umut Çakıroğlu', target: 0, actual: 0, title: 'Direktör' },
        { name: 'Umut Karaerarslan', target: 750000, actual: 0, title: 'Kıdemli Uzman' },
        { name: 'Gizem Ilısu', target: 250000, actual: 0, title: '' }
      ]
    };

    // Yıllık hedefler (görselden alınan)
    const annualTargets = {
      'Betül Köse': 450000,
      'Damla Kalemtaş': 4830000,
      'Egehan Öncü': 4022000,
      'Fahri Aktoz': 8850000,
      'Güven Salıkoç': 7265000,
      'Hüseyin Çakmak': 9232000,
      'Özge Kaçaroğlu': 450000,
      'Sebahat Çay': 8212000,
      'Tuğçe Bugakaptan': 7465000,
      'Umut Karaerarslan': 7080000,
      // Bireysel hedefi olmayan/dışındaki roller 0 kabul edilir
      'Umut Çakıroğlu': 0,
      'Ali Altınay': 0,
      'Batuhan Arısüt': 0,
      'Doğukan Kalyoncu': 0,
      'İlter Demirci': 0,
      'Muhammed Sivaslıgil': 0
    };

    // Aylık hedef ve gerçekleşenleri toplayıp yıllık listeyi üret (Ocak–Ağustos + Eylül)
    function normalizeName(name){
      const map = {
        'Güven Gürkan Salıkoç': 'Güven Salıkoç',
        'Muhammed Masum Sivaslıgil': 'Muhammed Sivaslıgil'
      };
      return map[name] || name;
    }

    function aggregateYearData(){
      const months = Object.keys(monthPeople); // ocak..agustos
      const byName = new Map();
      for (const m of months){
        for (const p of monthPeople[m]){
          const key = normalizeName(p.name);
          if (!byName.has(key)){
            byName.set(key, {
              name: key,
              title: p.title || '',
              manager: !!p.manager,
              inactive: !!p.inactive,
              target: 0,
              actual: 0
            });
          }
          const ref = byName.get(key);
          if (!ref.title && p.title) ref.title = p.title; // boşsa unvanı güncelle
          ref.actual += (p.actual || 0);
          ref.target += (p.target || 0);
        }
      }

      // Eylül verilerini de dahil et (people dizisi: hedef ve gerçekleşen)
      for (const p of people){
        const key = normalizeName(p.name);
        if (!byName.has(key)){
          byName.set(key, {
            name: key,
            title: p.title || '',
            manager: false,
            inactive: false,
            target: 0,
            actual: 0
          });
        }
        const ref = byName.get(key);
        if (!ref.title && p.title) ref.title = p.title;
        ref.actual += (p.actual || 0);
        ref.target += (p.target || 0);
      }
      return Array.from(byName.values());
    }

    function renderYearSummary(list){
      const totalTarget = list.reduce((s,p)=> s + (p.target || 0), 0);
      const totalActual = list.reduce((s,p)=> s + (p.actual || 0), 0);
      const rate = totalTarget > 0 ? (totalActual / totalTarget) * 100 : 0;
      const el = document.getElementById('yearSummaryStats');
      el.innerHTML = `
        <div class="summary-item">
          <div class="label">Toplam Yıllık Hedef</div>
          <div class="value">₺${totalTarget.toLocaleString('tr-TR')}</div>
        </div>
        <div class="summary-item">
          <div class="label">Toplam Yıllık Gerçekleşen</div>
          <div class="value">₺${totalActual.toLocaleString('tr-TR')}</div>
        </div>
        <div class="summary-item">
          <div class="label">Başarı Oranı</div>
          <div class="value">%${rate.toFixed(1)}</div>
        </div>`;
    }

    function renderYearDashboard(){
      const list = aggregateYearData();
      const sorted = [...list].sort((a,b)=>{
        const ar = a.target > 0 ? (a.actual/a.target) : 0;
        const br = b.target > 0 ? (b.actual/b.target) : 0;
        return br - ar;
      });
      // Hide leader cards from the grid but keep them in totals
      const display = sorted.filter(p => !(p.manager || p.title === 'Direktör' || p.role === 'Direktör') && !hiddenNames.includes(p.name));
      document.getElementById('yearSpeedometerGrid').innerHTML = display.map(createSpeedometer).join('');
      renderYearSummary(sorted);

      // Render audit table for quick validation
      const rows = sorted.map(p => `
        <div style="display:grid; grid-template-columns: 220px 1fr 1fr 1fr; gap:8px; padding:6px 0; border-bottom:1px solid #eee;">
          <div><strong>${p.name}</strong>${p.title ? ` — <span style='color:#6b7280;'>${p.title}</span>` : ''}</div>
          <div>Hedef: ₺${(p.target||0).toLocaleString('tr-TR')}</div>
          <div>Gerçekleşen: ₺${(p.actual||0).toLocaleString('tr-TR')}</div>
          <div>Başarı: ${(p.target>0? (p.actual/p.target*100):0).toFixed(1)}%</div>
        </div>
      `).join('');
      document.getElementById('yearTotalsTable').innerHTML = rows;
    }

    function showYear(){
      renderYearDashboard();
      document.getElementById('septemberDashboardContainer').style.display = 'none';
      document.getElementById('monthDashboardContainer').style.display = 'none';
      document.getElementById('yearDashboardContainer').style.display = 'block';
      closeMenu();
    }

    function showSeptember(){
      document.getElementById('septemberDashboardContainer').style.display = 'block';
      document.getElementById('monthDashboardContainer').style.display = 'none';
      const y = document.getElementById('yearDashboardContainer'); if (y) y.style.display = 'none';
      closeMenu();
    }

    function renderMonthSummary(list){
      const totalTarget = list.reduce((s,p)=> s + (p.target || 0), 0);
      const totalActual = list.reduce((s,p)=> s + (p.actual || 0), 0);
      const rate = totalTarget > 0 ? (totalActual / totalTarget) * 100 : 0;
      const el = document.getElementById('monthSummaryStats');
      el.innerHTML = `
        <div class="summary-item">
          <div class="label">Toplam Hedef</div>
          <div class="value">₺${totalTarget.toLocaleString('tr-TR')}</div>
        </div>
        <div class="summary-item">
          <div class="label">Toplam Gerçekleşen</div>
          <div class="value">₺${totalActual.toLocaleString('tr-TR')}</div>
        </div>
        <div class="summary-item">
          <div class="label">Başarı Oranı</div>
          <div class="value">%${rate.toFixed(1)}</div>
        </div>`;
    }

    function showMonth(key){
      // set title
      document.getElementById('monthTitle').textContent = monthLabels[key] + ' Dashboard';
      const grid = document.getElementById('monthSpeedometerGrid');
      const list = monthPeople[key] || personNames.map(n => ({ name: n, target: 0, actual: 0 }));
      const sorted = [...list].sort((a,b) => {
        const ar = a.target > 0 ? (a.actual/a.target) : 0;
        const br = b.target > 0 ? (b.actual/b.target) : 0;
        return br - ar;
      });
      // Hide leaders' cards (e.g., Ali Altınay, Umut Çakıroğlu) but keep them in the summary
      const display = sorted.filter(p => !(p.manager || p.title === 'Direktör' || p.role === 'Direktör'));
      grid.innerHTML = display.map(createSpeedometer).join('');
      renderMonthSummary(sorted);
      // show month, hide september
      document.getElementById('septemberDashboardContainer').style.display = 'none';
      document.getElementById('monthDashboardContainer').style.display = 'block';
      const y = document.getElementById('yearDashboardContainer'); if (y) y.style.display = 'none';
      closeMenu();
    }
  </script>
</body>
</html>
